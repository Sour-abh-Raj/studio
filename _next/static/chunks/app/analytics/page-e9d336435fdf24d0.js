(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{18495:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>T});var s=a(95155),r=a(27600),n=a(12115),l=a(28666),o=a(80644),i=a(78816),d=a(83013),c=a(83540),h=a(3401),u=a(94754),f=a(96025),y=a(16238),p=a(94517),x=a(24026),g=a(83394),j=a(8782),v=a(34e3),k=a(54811),S=a(81499),m=a(66695),w=a(87481);let D={thought:"hsl(var(--chart-1))",planned:"hsl(var(--chart-2))",working:"hsl(var(--chart-3))",done:"hsl(var(--chart-4))"},I={thought:{label:"Thoughts",color:D.thought},planned:{label:"Planned",color:D.planned},working:{label:"Working",color:D.working},done:{label:"Done",color:D.done}};function T(){let{user:t,loading:e}=(0,r.A)(),{toast:a}=(0,w.dj)(),[D,T]=(0,n.useState)([]),[A,b]=(0,n.useState)({thought:0,planned:0,working:0,done:0}),[E,O]=(0,n.useState)(!0);if((0,n.useEffect)(()=>{t&&t.uid&&(async()=>{O(!0);try{let e=(0,o.o)(new Date),a=(0,o.o)((0,i.e)(e,6)),s=await (0,l.t5)(t.uid,(0,d.GP)(a,"yyyy-MM-dd"),(0,d.GP)(e,"yyyy-MM-dd")),r=new Map,n={thought:0,planned:0,working:0,done:0};for(let t=0;t<7;t++){let a=(0,i.e)(e,t),s=(0,d.GP)(a,"yyyy-MM-dd");r.set(s,{date:(0,d.GP)(a,"MMM d"),fullDate:s,thought:0,planned:0,working:0,done:0,total:0})}s.forEach(t=>{let e=r.get(t.date);e&&(e[t.status]++,e.total++,n[t.status]++)}),T(Array.from(r.values()).sort((t,e)=>new Date(t.fullDate).getTime()-new Date(e.fullDate).getTime())),b(n)}catch(t){console.error("Error fetching analytics:",t),a({title:"Error fetching analytics",description:t.message,variant:"destructive"})}finally{O(!1)}})()},[t,a]),e)return(0,s.jsx)("div",{className:"flex items-center justify-center h-[calc(100vh-10rem)]",children:(0,s.jsx)("p",{children:"Loading analytics..."})});if(!t)return(0,s.jsx)("div",{className:"flex items-center justify-center h-[calc(100vh-10rem)]",children:(0,s.jsx)("p",{children:"Please log in to view analytics."})});let M=Object.keys(A).map(t=>({name:I[t].label,value:A[t],fill:I[t].color})).filter(t=>t.value>0);return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"Task Analytics"}),(0,s.jsxs)(m.Zp,{className:"shadow-lg",children:[(0,s.jsxs)(m.aR,{children:[(0,s.jsx)(m.ZB,{className:"text-xl font-headline",children:"Task Distribution (Last 7 Days)"}),(0,s.jsx)(m.BT,{children:"Breakdown of tasks by status over the last 7 days."})]}),(0,s.jsx)(m.Wu,{children:E?(0,s.jsx)("p",{children:"Loading chart data..."}):D.length>0?(0,s.jsx)(S.at,{config:I,className:"min-h-[300px] w-full",children:(0,s.jsx)(c.u,{width:"100%",height:350,children:(0,s.jsxs)(h.E,{data:D,margin:{top:5,right:20,left:-20,bottom:5},children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3",vertical:!1}),(0,s.jsx)(f.W,{dataKey:"date",tickLine:!1,axisLine:!1,tickMargin:8}),(0,s.jsx)(y.h,{allowDecimals:!1,tickLine:!1,axisLine:!1,tickMargin:8}),(0,s.jsx)(p.m,{cursor:{fill:"hsl(var(--muted))"},content:(0,s.jsx)(S.Nt,{indicator:"dot"})}),(0,s.jsx)(x.s,{}),(0,s.jsx)(g.y,{dataKey:"thought",stackId:"a",fill:"var(--color-thought)",radius:[4,4,0,0]}),(0,s.jsx)(g.y,{dataKey:"planned",stackId:"a",fill:"var(--color-planned)",radius:[4,4,0,0]}),(0,s.jsx)(g.y,{dataKey:"working",stackId:"a",fill:"var(--color-working)",radius:[4,4,0,0]}),(0,s.jsx)(g.y,{dataKey:"done",stackId:"a",fill:"var(--color-done)",radius:[4,4,0,0]})]})})}):(0,s.jsx)("p",{children:"No task data available for the last 7 days to display charts."})})]}),(0,s.jsxs)(m.Zp,{className:"shadow-lg",children:[(0,s.jsxs)(m.aR,{children:[(0,s.jsx)(m.ZB,{className:"text-xl font-headline",children:"Overall Status Breakdown (Last 7 Days)"}),(0,s.jsx)(m.BT,{children:"Total count of tasks in each status over the last 7 days."})]}),(0,s.jsx)(m.Wu,{children:E?(0,s.jsx)("p",{children:"Loading pie chart..."}):M.length>0?(0,s.jsx)(S.at,{config:I,className:"min-h-[300px] w-full aspect-square sm:aspect-video",children:(0,s.jsx)(c.u,{width:"100%",height:350,children:(0,s.jsxs)(j.r,{children:[(0,s.jsx)(p.m,{content:(0,s.jsx)(S.Nt,{hideLabel:!0,nameKey:"name"})}),(0,s.jsx)(v.F,{data:M,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:120,labelLine:!1,label:t=>{let{name:e,percent:a}=t;return"".concat(e," (").concat((100*a).toFixed(0),"%)")},children:M.map((t,e)=>(0,s.jsx)(k.f,{fill:t.fill},"cell-".concat(e)))}),(0,s.jsx)(x.s,{})]})})}):(0,s.jsx)("p",{children:"No tasks to display in the pie chart for the last 7 days."})})]})]})}},28666:(t,e,a)=>{"use strict";a.d(e,{XZ:()=>l,lC:()=>o,qB:()=>n,t5:()=>d,vq:()=>i});var s=a(67039),r=a(35317);let n=(t,e,a,n)=>{if(!t)return n(Error("User ID is not available. Cannot fetch tasks.")),()=>{};let l=(0,r.rJ)(s.db,"users/".concat(t,"/tasks")),o=(0,r.P)(l,(0,r._M)("date","==",e),(0,r.My)("order","asc"));return(0,r.aQ)(o,t=>{let e=[];t.forEach(t=>{var a,s;let r=t.data();e.push({id:t.id,title:r.title,status:r.status,order:r.order,notes:r.notes,userId:r.userId,createdAt:(null==(a=r.createdAt)?void 0:a.toDate().toISOString())||new Date().toISOString(),updatedAt:(null==(s=r.updatedAt)?void 0:s.toDate().toISOString())||new Date().toISOString(),date:r.date})}),a(e)},t=>{console.error("Error fetching tasks: ",t),n(t)})},l=async(t,e)=>{if(!t)throw Error("User ID is not available. Cannot add task.");let a=(0,r.rJ)(s.db,"users/".concat(t,"/tasks"));await (0,r.gS)(a,{...e,userId:t,status:"thought",createdAt:(0,r.O5)(),updatedAt:(0,r.O5)()})},o=async(t,e,a)=>{if(!t)throw Error("User ID is not available. Cannot update task.");let n=(0,r.H9)(s.db,"users/".concat(t,"/tasks/").concat(e));await (0,r.mZ)(n,{...a,updatedAt:(0,r.O5)()})},i=async(t,e)=>{if(!t)throw Error("User ID is not available. Cannot delete task.");let a=(0,r.H9)(s.db,"users/".concat(t,"/tasks/").concat(e));await (0,r.kd)(a)},d=async(t,e,a)=>{if(!t)throw Error("User ID is not available. Cannot fetch tasks for range.");let n=(0,r.rJ)(s.db,"users/".concat(t,"/tasks")),l=(0,r.P)(n,(0,r._M)("date",">=",e),(0,r._M)("date","<=",a),(0,r.My)("date","asc"),(0,r.My)("order","asc")),o=await (0,r.GG)(l),i=[];return o.forEach(t=>{var e,a;let s=t.data();i.push({id:t.id,title:s.title,status:s.status,order:s.order,notes:s.notes,userId:s.userId,createdAt:(null==(e=s.createdAt)?void 0:e.toDate().toISOString())||new Date().toISOString(),updatedAt:(null==(a=s.updatedAt)?void 0:a.toDate().toISOString())||new Date().toISOString(),date:s.date})}),i}},33903:(t,e,a)=>{Promise.resolve().then(a.bind(a,18495))},87481:(t,e,a)=>{"use strict";a.d(e,{dj:()=>u});var s=a(12115);let r=0,n=new Map,l=t=>{if(n.has(t))return;let e=setTimeout(()=>{n.delete(t),c({type:"REMOVE_TOAST",toastId:t})},1e6);n.set(t,e)},o=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:a}=e;return a?l(a):t.toasts.forEach(t=>{l(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===a||void 0===a?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}},i=[],d={toasts:[]};function c(t){d=o(d,t),i.forEach(t=>{t(d)})}function h(t){let{...e}=t,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...e,id:a,open:!0,onOpenChange:t=>{t||s()}}}),{id:a,dismiss:s,update:t=>c({type:"UPDATE_TOAST",toast:{...t,id:a}})}}function u(){let[t,e]=s.useState(d);return s.useEffect(()=>(i.push(e),()=>{let t=i.indexOf(e);t>-1&&i.splice(t,1)}),[t]),{...t,toast:h,dismiss:t=>c({type:"DISMISS_TOAST",toastId:t})}}}},t=>{var e=e=>t(t.s=e);t.O(0,[992,644,396,244,197,782,732,441,684,358],()=>e(33903)),_N_E=t.O()}]);